<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simulation of a CS FMU · FMI.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FMI.jl logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/overview/">Overview</a></li><li><a class="tocitem" href="../../tutorials/load_unload/">Load/Unload a FMU</a></li><li><a class="tocitem" href="../../tutorials/simulate/">Simulate a FMU</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples/">Overview</a></li><li class="is-active"><a class="tocitem" href>Simulation of a CS FMU</a></li><li><a class="tocitem" href="../simulateME/">Simulation of a ME FMU</a></li><li><a class="tocitem" href="../parameterize/">Parameterize</a></li><li><a class="tocitem" href="../multipleInstance/">Simulate multiple instances</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Library Functions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/library/">FMI 2 library functions</a></li><li><a class="tocitem" href="../../library/library_ind/">FMI version independent functions</a></li><li><a class="tocitem" href="../../library/fmu2/">FMU 2 functions</a></li><li><a class="tocitem" href="../../library/fmu/">FMU version independent functions</a></li></ul></li><li><a class="tocitem" href="../../related/">Related Publications</a></li><li><a class="tocitem" href="../../contents/">Contents</a></li><li><a class="tocitem" href="../../indices/">Library Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Simulation of a CS FMU</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simulation of a CS FMU</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ThummeTo/FMI.jl/blob/master/docs/src/examples/CS_simulation.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="cs"><a class="docs-heading-anchor" href="#cs">Simulation of a CS FMU</a><a id="cs-1"></a><a class="docs-heading-anchor-permalink" href="#cs" title="Permalink"></a></h1><p>This small example shows a fast and easy way to simulate a co simulation FMU.</p><p>This first command loads the FMI.jl library, so you could work with it.</p><pre><code class="language-julia">#
# Copyright (c) 2021 Tobias Thummerer, Lars Mikelsons, Josef Kircher
# Licensed under the MIT license. See LICENSE file in the project root for details.
#

using FMI</code></pre><p>The next part sets up the start and stop time, step size and the discrete time points for which values should be safed.</p><pre><code class="language-julia"># our simulation setup
dt = 0.01
t_start = 0.0
t_stop = 8.0
saveat = t_start:dt:t_stop</code></pre><p>The FMI.jl library contains two FMUs to try things out and the examples. One of those are compiled for Windows and Linux, the other one only for Windows.</p><pre><code class="language-julia"># this FMU runs under Windows/Linux
pathToFMU = joinpath(dirname(@__FILE__), &quot;../model/OpenModelica/v1.17.0/SpringFrictionPendulum1D.fmu&quot;)

# this FMU runs only under Windows
if Sys.iswindows()
    pathToFMU = joinpath(dirname(@__FILE__), &quot;../model/Dymola/2020x/SpringFrictionPendulum1D.fmu&quot;)
end</code></pre><p><a href="../../library/fmu/#FMI.fmiLoad"><code>fmiLoad</code></a> unpacks the FMU, reads the model description and stores all the necessary information of the FMU in <code>myFMU</code>. You can read a useful part of the informations with <a href="../../library/fmu/#FMI.fmiInfo"><code>fmiInfo</code></a>. With <a href="../../library/library_ind/#FMI.fmiInstantiate!"><code>fmiInstantiate!</code></a> am instance of the FMU is created.</p><pre><code class="language-julia"># load the FMU container
myFMU = fmiLoad(pathToFMU)

# print some useful FMU-information into the REPL
fmiInfo(myFMU)

# make an instance from the FMU
fmiInstantiate!(myFMU; loggingOn=true)</code></pre><p>To simulate the instance of the FMU you have to setup the experiment and enter and leave the initialization mode to prepare the FMU. This part is optional if you use the option <code>setup=true</code> in <a href="../../library/fmu/#FMI.fmiSimulateCS"><code>fmiSimulateCS</code></a>.</p><pre><code class="language-julia"># setup the experiment, start time = 0.0 (optional for setup=true)
fmiSetupExperiment(myFMU, t_start)

# enter and exit initialization (optional for setup=true)
fmiEnterInitializationMode(myFMU)
fmiExitInitializationMode(myFMU)</code></pre><p>The next part is the actual simulation. FMI.jl provides you with an easy way to do it. The <a href="../../library/fmu/#FMI.fmiSimulateCS"><code>fmiSimulateCS</code></a> function expects the FMU or instance of an FMU you want to simulate, the start and stop time of the simulation. Additionally you can give an array of variable names which you want to track. The return value of the function is that data. You can also facilitate the setup of the simulation with the second option.</p><pre><code class="language-julia"># run the FMU in mode Co-Simulation (CS) with adaptive step size (CVODE) but fixed save points dt,
# result values are stored in `data`
data = fmiSimulateCS(myFMU, t_start, t_stop; recordValues=[&quot;mass.s&quot;, &quot;mass.v&quot;], setup=true)</code></pre><p>FMI.jl offers a simple way to visualize the simulation results with the <a href="../../library/fmu/#FMI.fmiPlot"><code>fmiPlot</code></a> function.</p><pre><code class="language-julia"># plot the results
fmiPlot(data)</code></pre><p>Finally, after your simulation is finished, you can unload the FMU and free the allocated memory.</p><pre><code class="language-julia"># unload the FMU, remove unpacked data on disc (&quot;clean up&quot;)
fmiUnload(myFMU)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Overview</a><a class="docs-footer-nextpage" href="../simulateME/">Simulation of a ME FMU »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 8 February 2022 10:08">Tuesday 8 February 2022</span>. Using Julia version 1.6.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
